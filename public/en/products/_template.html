<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Loading... ‚Äî Kazan Delicacies</title>
  <meta name="robots" content="index, follow">
  <link rel="alternate" hreflang="ru" href="https://api.pepperoni.tatar/products/">
  <link rel="alternate" hreflang="en" href="https://api.pepperoni.tatar/en/products/">

  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#fafafa;color:#1a1a1a;line-height:1.6}
    .container{max-width:900px;margin:0 auto;padding:40px 24px}
    .badge{display:inline-block;background:#1b7a3d;color:#fff;padding:4px 12px;border-radius:4px;font-size:.85rem;font-weight:600;letter-spacing:.5px}
    .price-big{font-size:2rem;font-weight:700;color:#1b7a3d;margin:16px 0}
    .price-vat{font-size:.85rem;color:#767676;font-weight:400}
    .avail{color:#1b7a3d;font-size:.9rem;margin:8px 0}
    .detail-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px 24px;margin:20px 0;font-size:.9rem}
    .detail-grid dt{color:#767676;font-weight:600}
    .detail-grid dd{color:#1a1a1a}
    .back-link{display:inline-block;margin-bottom:24px;color:#0066cc;text-decoration:none;font-size:.9rem}
    .back-link:hover{text-decoration:underline}
    .cta-box{background:#f0f7f0;border:2px solid #1b7a3d;border-radius:10px;padding:24px;margin-top:24px}
    .cta-box a{display:inline-block;padding:10px 24px;border-radius:8px;text-decoration:none;font-weight:600;font-size:.9rem;margin:4px 6px 4px 0}
    footer{text-align:center;color:#555;font-size:.85rem;padding-top:24px;margin-top:32px}
    footer a{color:#444;text-decoration:none}
    #loading{text-align:center;padding:60px;color:#aaa;font-size:1.1rem}
    @media(max-width:600px){.detail-grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="container">
    <div style="display:flex;gap:16px;flex-wrap:wrap;margin-bottom:24px;padding-bottom:16px;border-bottom:1px solid #eee;font-size:.9rem">
      <a href="/en/" style="color:#0066cc;text-decoration:none">Catalog</a>
      <a href="/en/pepperoni" style="color:#0066cc;text-decoration:none">Pepperoni</a>
      <a href="/en/about" style="color:#0066cc;text-decoration:none">About</a>
      <a href="/en/faq" style="color:#0066cc;text-decoration:none">FAQ</a>
      <a href="/en/delivery" style="color:#0066cc;text-decoration:none">Delivery</a>
      <a href="/" style="color:#595959;text-decoration:none;margin-left:auto">üá∑üá∫ –†—É—Å—Å–∫–∏–π</a>
    </div>

    <div id="product-content">
      <div id="loading">Loading product...</div>
    </div>

    <footer>
      <p><a href="/en/pepperoni">Pepperoni</a> ¬∑ <a href="/en/about">About</a> ¬∑ <a href="/en/faq">FAQ</a> ¬∑ <a href="/en/delivery">Delivery</a></p>
      <p>¬© <a href="https://kazandelikates.tatar">Kazan Delicacies</a> ¬∑ <a href="https://pepperoni.tatar">pepperoni.tatar</a></p>
    </footer>
  </div>

  <script>
    async function loadProduct(){
      const path=window.location.pathname;
      const sku=path.split('/').pop();
      if(!sku){document.getElementById('loading').textContent='Product not found';return;}

      try{
        const res=await fetch('/api/products');
        const data=await res.json();
        const product=data.products.find(p=>p.sku===sku);
        if(!product){document.getElementById('loading').textContent='Product not found: '+sku;return;}

        const p=product;
        const isBakery=!!p.offers?.pricePerUnit;
        const priceUSD=p.offers?.exportPrices?.USD;
        const priceRUB=isBakery?p.offers.pricePerUnit:p.offers.price;

        document.title=`${p.name} ‚Äî Kazan Delicacies`;

        let html=`<a href="/en/" class="back-link">‚Üê Back to catalog</a>`;
        html+=`<h1 style="font-size:1.6rem;margin-bottom:8px">${p.name}</h1>`;
        html+=`<div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px">`;
        html+=`<span class="badge">HALAL</span>`;
        html+=`<span class="badge" style="background:#0066cc">${p.sku}</span>`;
        if(p.section)html+=`<span class="badge" style="background:#555">${p.section}</span>`;
        html+=`</div>`;

        if(priceUSD){
          html+=`<div class="price-big">$${parseFloat(priceUSD).toLocaleString('en-US',{minimumFractionDigits:2})}`;
          if(isBakery)html+=`<span class="price-vat"> /pc</span>`;
          else html+=`<span class="price-vat"> excl. VAT</span>`;
          html+=`</div>`;
        }
        html+=`<div style="color:#767676;font-size:.9rem">${parseFloat(priceRUB).toLocaleString('en-US')} ‚ÇΩ${isBakery?' /pc':' incl. VAT'}</div>`;
        html+=`<div class="avail">‚úì In stock</div>`;

        if(isBakery&&p.offers.pricePerBox){
          html+=`<div style="margin-top:8px;font-size:.9rem;color:#444">Price per box: <b>${parseFloat(p.offers.pricePerBox).toLocaleString('en-US')} ‚ÇΩ</b>${p.qtyPerBox?' ('+p.qtyPerBox+' pcs)':''}</div>`;
        }

        html+=`<dl class="detail-grid">`;
        if(p.category)html+=`<dt>Category</dt><dd>${p.category}</dd>`;
        if(p.weight)html+=`<dt>Unit weight</dt><dd>${p.weight} kg</dd>`;
        if(p.shelfLife)html+=`<dt>Shelf life</dt><dd>${p.shelfLife}</dd>`;
        if(p.storage)html+=`<dt>Storage</dt><dd>${p.storage}</dd>`;
        if(p.hsCode)html+=`<dt>HS Code</dt><dd>${p.hsCode}</dd>`;
        html+=`<dt>Brand</dt><dd>${p.brand||'Kazan Delicacies'}</dd>`;
        html+=`<dt>Certification</dt><dd>${p.certification||'Halal'}</dd>`;
        html+=`<dt>Delivery</dt><dd>${p.offers?.deliveryTerms||'EXW Kazan Russia'}</dd>`;
        html+=`</dl>`;

        const ep=p.offers?.exportPrices;
        if(ep&&Object.keys(ep).length){
          html+=`<h3 style="margin-top:20px;font-size:1rem;color:#1b7a3d">Export Prices</h3>`;
          html+=`<div style="display:flex;gap:12px;flex-wrap:wrap;margin:8px 0">`;
          const syms={USD:'$',KZT:'‚Ç∏',UZS:'UZS',KGS:'KGS',BYN:'BYN',AZN:'AZN'};
          for(const[cur,val]of Object.entries(ep)){
            if(val)html+=`<span style="background:#fff;border:1px solid #ddd;padding:6px 12px;border-radius:6px;font-size:.85rem"><b>${val}</b> ${syms[cur]||cur}</span>`;
          }
          html+=`</div>`;
        }

        html+=`<div class="cta-box">`;
        html+=`<h3 style="margin:0 0 8px">Order</h3>`;
        html+=`<p style="color:#444;margin-bottom:12px">Wholesale, export, Private Label available</p>`;
        html+=`<a href="tel:+79872170202" style="background:#1b7a3d;color:#fff">üìû +7 987 217-02-02</a>`;
        html+=`<a href="mailto:info@kazandelikates.tatar?subject=Order: ${encodeURIComponent(p.name)} (${p.sku})" style="border:2px solid #1b7a3d;color:#1b7a3d">üìß Email</a>`;
        html+=`</div>`;

        document.getElementById('product-content').innerHTML=html;

        const ld={"@context":"https://schema.org","@type":"Product","name":p.name,"sku":p.sku,"brand":{"@type":"Brand","name":"Kazan Delicacies"},"offers":{"@type":"Offer","priceCurrency":"USD","price":priceUSD||priceRUB,"availability":"https://schema.org/InStock","url":window.location.href}};
        const s=document.createElement('script');s.type='application/ld+json';s.textContent=JSON.stringify(ld);document.head.appendChild(s);
      }catch(e){
        document.getElementById('loading').textContent='Loading error: '+e.message;
      }
    }
    loadProduct();
  </script>
</body>
</html>
